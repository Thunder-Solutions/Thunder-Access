"use strict";function e(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Object.defineProperty(exports,"__esModule",{value:!0});var t=function(e){"undefined"==typeof jest&&console.error("".concat("Problem evaluating accessibility",": ").concat(e))},r=function(e){throw new Error("".concat("Problem evaluating accessibility",": ").concat(e))},n=function(e){var r="string"==typeof e,n=!0;try{c().querySelector(e)}catch(e){n=!1}var i=r&&n;return i||t("".concat(e," is not a valid selector.")),i},i=function(){return e(c().querySelectorAll('\n    a:not([disabled]):not([tabindex="-1"]),\n    button:not([disabled]):not([tabindex="-1"]),\n    input:not([disabled]):not([tabindex="-1"]),\n    [tabindex]:not([disabled]):not([tabindex="-1"])\n  ')).filter((function(e){return!e.closest('[aria-hidden="true"]')||!!e.offsetParent}))},o={_listeners:{addQueue:[],removeQueue:[],current:new Map},add:function(e,t,r){this._listeners.addQueue.push({selector:e,event:t,listener:r})},removeAll:function(e){this._listeners.removeQueue.push(e)},update:function(){var t=this._listeners;t.addQueue.forEach((function(r){var n=r.selector,i=r.event,o=r.listener,a=t.current.get(n)||[];a.find((function(e){return e.event===i&&String(e.listener)===String(o)}))||e(document.querySelectorAll(n)).forEach((function(e){e.addEventListener(i,o),a.push({event:i,listener:o}),t.current.set(n,a)}))})),t.removeQueue.forEach((function(r){var n=t.current.get(r);if(n){var i=[];n.forEach((function(n){var o=n.event,a=n.listener;if(t.addQueue.filter((function(e){return e.selector===r})).find((function(e){return e.event===o&&String(e.listener)===String(a)})))return i.push({event:o,listener:a});e(document.querySelectorAll(r)).forEach((function(e){return e.removeEventListener(o,a)}))})),t.current.set(r,i)}})),t.removeQueue=[],t.addQueue=[]}},a={element:null},c=function(){return a.element||"undefined"!=typeof document&&document.body||r("Could not find the root element.")},u=new Map,s=function(e){return u.get(e)||u.set(e,{inlineAttributes:Array.from(e.attributes),attributeObserver:null,screenReaderElement:null,methods:{},rules:{}}),u.get(e)},l=function(e,t){var r=s(e);u.set(e,t(r))},f=function(e){var t,r,n=e,i={a:0,b:0,c:0},o=[];return t=function(t,r){var a,c,u,s,l,f;if(t.test(n))for(c=0,u=(a=n.match(t)).length;c<u;c+=1)i[r]+=1,s=a[c],l=n.indexOf(s),f=s.length,o.push({selector:e.substr(l,f),type:r,index:l,length:f}),n=n.replace(s,Array(f+1).join(" "))},(r=function(e){var t,r,i,o;if(e.test(n))for(r=0,i=(t=n.match(e)).length;r<i;r+=1)o=t[r],n=n.replace(o,Array(o.length+1).join("A"))})(/\\[0-9A-Fa-f]{6}\s?/g),r(/\\[0-9A-Fa-f]{1,5}\s/g),r(/\\./g),function(){var e,t,r,i,o=/{[^]*/gm;if(o.test(n))for(t=0,r=(e=n.match(o)).length;t<r;t+=1)i=e[t],n=n.replace(i,Array(i.length+1).join(" "))}(),t(/(\[[^\]]+\])/g,"b"),t(/(#[^\#\s\+>~\.\[:\)]+)/g,"a"),t(/(\.[^\s\+>~\.\[:\)]+)/g,"b"),t(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c"),t(/(:(?!not|global|local)[\w-]+\([^\)]*\))/gi,"b"),t(/(:(?!not|global|local)[^\s\+>~\.\[:]+)/g,"b"),n=(n=(n=(n=(n=(n=n.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," ")).replace(/:not/g,"    ")).replace(/:local/g,"      ")).replace(/:global/g,"       ")).replace(/[\(\)]/g," "),t(/([^\s\+>~\.\[:]+)/g,"c"),o.sort((function(e,t){return e.index-t.index})),{selector:e,specificity:"0,"+i.a.toString()+","+i.b.toString()+","+i.c.toString(),specificityArray:[0,i.a,i.b,i.c],parts:o}},d=function(e,t){var r,n,i;if("string"==typeof e){if(-1!==e.indexOf(","))throw"Invalid CSS selector";r=f(e).specificityArray}else{if(!Array.isArray(e))throw"Invalid CSS selector or specificity array";if(4!==e.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";r=e}if("string"==typeof t){if(-1!==t.indexOf(","))throw"Invalid CSS selector";n=f(t).specificityArray}else{if(!Array.isArray(t))throw"Invalid CSS selector or specificity array";if(4!==t.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";n=t}for(i=0;i<4;i+=1){if(r[i]<n[i])return-1;if(r[i]>n[i])return 1}return 0},b=function(e){if(e instanceof HTMLElement)return e.focus();if(e.constructor!==String)return t("the `focus()` method expects either an element or a string.");var r=i(),o=r.findIndex((function(e){return e===document.activeElement})),a=r.length-1;switch(e){case"next":r[o<a?o+1:0].focus();break;case"previous":r[o>0?o-1:a].focus();break;case"off":document.activeElement.blur()}["next","previous","off"].includes(e)||n(e)&&c().querySelector(e).focus()},v=function(e,t,r){var n=c(),i=n.querySelector(e),o=n.querySelector(t),a=void 0!==r?r:!!i&&"true"===i.getAttribute("aria-expanded");i?i.setAttribute("aria-expanded",!a):console.error("Error expanding the element: No parent item matched the selector."),o?o.setAttribute("aria-hidden",a):console.error("Error expanding the element: No child item matched the selector.")},p=function(e){return"true"===("string"==typeof e?n(e)&&root.querySelector(e):e).getAttribute("aria-expanded")},h={externalElements:new Map,parentElement:null,isTrapped:!1},m=function(e,t){h.parentElement="string"==typeof e?n(e)&&c().querySelector(e):e;var r=i(),o=h.parentElement?r.filter((function(e){return!h.parentElement.contains(e)})):console.error("Error applying focus trap: No element matched the selector.")||[],a=h.externalElements;a.forEach((function(e,t){null!==e?t.setAttribute("tabindex",e):t.removeAttribute("tabindex"),a.delete(t)}));var u=void 0!==t?t:!h.isTrapped;u&&o.forEach((function(e){h.externalElements.set(e,e.getAttribute("tabindex")),e.setAttribute("tabindex","-1")})),h.isTrapped=u},y=function(e){return{focus:b,toggleExpanded:v,getExpanded:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return p(t)},toggleFocusTrap:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return m(t)}}},g=function(e){var r=s(e),n=r.inlineAttributes,i=r.rules,o=function(r,i){var o=e.getAttribute(r)===String(i),a=!!n.find((function(e){return e.name===r}));if(["class","id","style"].includes(r)||r.startsWith("on"))return t('Cannot assign black-listed attribute: "'.concat(r,'"'));a||o||e.setAttribute(r,i)};Object.keys(i).forEach((function(t){if(e.matches(t)){var r=i[t],n=r.aria,a=r.attr;n&&Object.keys(n).forEach((function(e){return o("aria-".concat(e),n[e])})),a&&Object.keys(a).forEach((function(e){return o(e,a[e])}))}}))},A=function(e){var r=s(e),n=r.rules,i=r.methods;Object.keys(n).forEach((function(r){if(o.removeAll(r),e.matches(r)){var a=n[r],c=a.keyboard,u=a.keyboardEvent;if(c){var s=y(e),l=Object.keys(c),f=u&&["keydown","keypress","keyup"].includes(u),d=f?u:"keydown";u&&!f&&t('"'.concat(u,'" is not a valid keyboard event; using "keydown" instead.')),o.add(r,d,(function(e){l.includes(e.key)&&c[e.key].forEach((function(t){return i[t](s,e)}))}))}}}))},E=function(e){var t=s(e),r=t.rules,n=t.methods;Object.keys(r).forEach((function(t){if(o.removeAll(t),e.matches(t)){var i=r[t].mouse;if(i){var a=y(e),c=i.click,u=i.enter,s=i.leave,l=function(e,r){o.add(t,r,(function(t){e.forEach((function(e){return n[e](a,t)}))}))};c&&l(c,"click"),u&&l(u,"mouseenter"),s&&l(s,"mouseleave")}}}))},x=function(e){var t=s(e),r=t.rules,n=t.screenReaderElement,i=Object.keys(r).reverse().find((function(t){return e.matches(t)&&"string"==typeof r[t].screenReaderText}));if(!i)return n&&n.remove();var o=r[i].screenReaderText;l(e,(function(e){var t;return e.screenReaderElement=e.screenReaderElement||((t=document.createElement("span")).style="position:absolute;z-index:-9999999;opacity:0;",t),e})),t.screenReaderElement.remove(),t.screenReaderElement.textContent=o,e.insertBefore(t.screenReaderElement,e.firstChild)},k=function(e){g(e),A(e),E(e),x(e),o.update()},S={updateAttrsInState:function(e,t){t.forEach((function(t){var r=t?t.target.attributes[t.attributeName]:{};l(e,(function(e){var t=e.inlineAttributes.findIndex((function(e){return e.name===r.name})),n=-1!==t?t:e.inlineAttributes.length;return r?e.inlineAttributes[n]=r:function(e,t){var r=e.length-1,n=e[r],i=e[t];e[r]=i,e[t]=n,e.pop()}(e.inlineAttributes,n),e}))}))},removeNonInlineAttrs:function(e){var t=s(e).inlineAttributes;Array.from(e.attributes).forEach((function(r){var n=r.name;!!t.find((function(e){return e.name===n}))||e.removeAttribute(n)}))},updateChildElAttrs:function(e){var t=this;e.querySelectorAll("*").forEach((function(e){var r=s(e).attributeObserver;r&&r.disconnect(),t.removeNonInlineAttrs(e),k(e),r&&setTimeout((function(){return r.observe(e,{attributes:!0})}),0)}))},setAttrChangeCallback:function(e){var t=this;this.attrChangeCallback=function(r,n){n.disconnect();var i=r.filter((function(e){var t=e.target,r=e.attributeName;return t.attributes[r]}));t.updateAttrsInState(e,i),t.removeNonInlineAttrs(e),k(e),t.updateChildElAttrs(e),setTimeout((function(){n.observe(e,{attributes:!0})}),0)}},attrChangeCallback:null},C={setApplyRulesCallback:function(t){var r=Object.keys(t.rules).sort(d);this.applyRulesCallback=function(i){return r.forEach((function(r){if(i&&!e(i.find((function(e){return e.addedNodes})).addedNodes).some((function(e){return e instanceof HTMLElement&&e.matches(r)})))return;n(r)&&c().querySelectorAll(r).forEach((function(e){var n=t.rules,i=t.methods,o=n&&n[r]||{};l(e,(function(e){return e.rules[r]=o,e.methods=i,e})),k(e),function(e){if("undefined"!=typeof MutationObserver){S.setAttrChangeCallback(e);var t=new MutationObserver(S.attrChangeCallback);t.observe(e,{attributes:!0}),l(e,(function(e){return e.attributeObserver=t,e}))}}(e)}))}))}},applyRulesCallback:null,observer:null},O=function(e){var t=e?e.constructor.name:String(e);e&&e.constructor===Object||r("Expected Object, but got ".concat(t)),a.element=e.root;var n=e.rules||{},i=e.methods||{};n.constructor===Object&&i.constructor===Object||r("The `rules` and `methods` properties must be objects."),"undefined"!=typeof MutationObserver&&(C.setApplyRulesCallback(e),C.observer=new MutationObserver(C.applyRulesCallback),C.observer.observe(c(),{childList:!0,subtree:!0})),C.applyRulesCallback()};exports.addAccessibilityRules=O,exports.default=O;