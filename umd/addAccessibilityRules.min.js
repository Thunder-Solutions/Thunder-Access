!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AccessibilityLayer={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a="Problem evaluating accessibility",c=function(e){"undefined"==typeof jest&&console.error("".concat(a,": ").concat(e))},u=function(e){throw new Error("".concat(a,": ").concat(e))},s=function(e){var t="string"==typeof e,n=!0;try{b().querySelector(e)}catch(e){n=!1}var r=t&&n;return r||c("".concat(e," is not a valid selector.")),r},l=function(){return i(b().querySelectorAll('\n    a:not([disabled]):not([tabindex="-1"]),\n    button:not([disabled]):not([tabindex="-1"]),\n    input:not([disabled]):not([tabindex="-1"]),\n    [tabindex]:not([disabled]):not([tabindex="-1"])\n  ')).filter((function(e){return!e.closest('[aria-hidden="true"]')||!!e.offsetParent}))},f={_listeners:{addQueue:[],removeQueue:[],current:new Map},add:function(e,t,n){this._listeners.addQueue.push({selector:e,event:t,listener:n})},removeAll:function(e){this._listeners.removeQueue.push(e)},update:function(){var e=this._listeners;e.addQueue.forEach((function(t){var n=t.selector,r=t.event,o=t.listener,a=e.current.get(n)||[];a.find((function(e){return e.event===r&&String(e.listener)===String(o)}))||i(document.querySelectorAll(n)).forEach((function(t){t.addEventListener(r,o),a.push({event:r,listener:o}),e.current.set(n,a)}))})),e.removeQueue.forEach((function(t){var n=e.current.get(t);if(n){var r=[];n.forEach((function(n){var o=n.event,a=n.listener;if(e.addQueue.filter((function(e){return e.selector===t})).find((function(e){return e.event===o&&String(e.listener)===String(a)})))return r.push({event:o,listener:a});i(document.querySelectorAll(t)).forEach((function(e){return e.removeEventListener(o,a)}))})),e.current.set(t,r)}})),e.removeQueue=[],e.addQueue=[]}},d={element:null},b=function(){return d.element||"undefined"!=typeof document&&document.body||u("Could not find the root element.")},v=new Map,p=function(e){return v.get(e)||v.set(e,{inlineAttributes:Array.from(e.attributes),attributeObserver:null,screenReaderElement:null,methods:{},rules:{}}),v.get(e)},h=function(e,t){var n=p(e);v.set(e,t(n))},m=function(e){var t,n,r=e,i={a:0,b:0,c:0},o=[];return t=function(t,n){var a,c,u,s,l,f;if(t.test(r))for(c=0,u=(a=r.match(t)).length;c<u;c+=1)i[n]+=1,s=a[c],l=r.indexOf(s),f=s.length,o.push({selector:e.substr(l,f),type:n,index:l,length:f}),r=r.replace(s,Array(f+1).join(" "))},(n=function(e){var t,n,i,o;if(e.test(r))for(n=0,i=(t=r.match(e)).length;n<i;n+=1)o=t[n],r=r.replace(o,Array(o.length+1).join("A"))})(/\\[0-9A-Fa-f]{6}\s?/g),n(/\\[0-9A-Fa-f]{1,5}\s/g),n(/\\./g),function(){var e,t,n,i,o=/{[^]*/gm;if(o.test(r))for(t=0,n=(e=r.match(o)).length;t<n;t+=1)i=e[t],r=r.replace(i,Array(i.length+1).join(" "))}(),t(/(\[[^\]]+\])/g,"b"),t(/(#[^\#\s\+>~\.\[:\)]+)/g,"a"),t(/(\.[^\s\+>~\.\[:\)]+)/g,"b"),t(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c"),t(/(:(?!not|global|local)[\w-]+\([^\)]*\))/gi,"b"),t(/(:(?!not|global|local)[^\s\+>~\.\[:]+)/g,"b"),r=(r=(r=(r=(r=(r=r.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," ")).replace(/:not/g,"    ")).replace(/:local/g,"      ")).replace(/:global/g,"       ")).replace(/[\(\)]/g," "),t(/([^\s\+>~\.\[:]+)/g,"c"),o.sort((function(e,t){return e.index-t.index})),{selector:e,specificity:"0,"+i.a.toString()+","+i.b.toString()+","+i.c.toString(),specificityArray:[0,i.a,i.b,i.c],parts:o}},y=function(e,t){var n,r,i;if("string"==typeof e){if(-1!==e.indexOf(","))throw"Invalid CSS selector";n=m(e).specificityArray}else{if(!Array.isArray(e))throw"Invalid CSS selector or specificity array";if(4!==e.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";n=e}if("string"==typeof t){if(-1!==t.indexOf(","))throw"Invalid CSS selector";r=m(t).specificityArray}else{if(!Array.isArray(t))throw"Invalid CSS selector or specificity array";if(4!==t.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";r=t}for(i=0;i<4;i+=1){if(n[i]<r[i])return-1;if(n[i]>r[i])return 1}return 0},g=function(e){if(e instanceof HTMLElement)return e.focus();if(e.constructor!==String)return c("the `focus()` method expects either an element or a string.");var t=l(),n=t.findIndex((function(e){return e===document.activeElement})),r=t.length-1;switch(e){case"next":t[n<r?n+1:0].focus();break;case"previous":t[n>0?n-1:r].focus();break;case"off":document.activeElement.blur()}["next","previous","off"].includes(e)||s(e)&&b().querySelector(e).focus()},A=function(e,t,n){var r=b(),i=r.querySelector(e),o=r.querySelector(t),a=void 0!==n?n:!!i&&"true"===i.getAttribute("aria-expanded");i?i.setAttribute("aria-expanded",!a):console.error("Error expanding the element: No parent item matched the selector."),o?o.setAttribute("aria-hidden",a):console.error("Error expanding the element: No child item matched the selector.")},E=function(e){return"true"===("string"==typeof e?s(e)&&root.querySelector(e):e).getAttribute("aria-expanded")},x={externalElements:new Map,parentElement:null,isTrapped:!1},k=function(e,t){x.parentElement="string"==typeof e?s(e)&&b().querySelector(e):e;var n=l(),r=x.parentElement?n.filter((function(e){return!x.parentElement.contains(e)})):console.error("Error applying focus trap: No element matched the selector.")||[],i=x.externalElements;i.forEach((function(e,t){null!==e?t.setAttribute("tabindex",e):t.removeAttribute("tabindex"),i.delete(t)}));var o=void 0!==t?t:!x.isTrapped;o&&r.forEach((function(e){x.externalElements.set(e,e.getAttribute("tabindex")),e.setAttribute("tabindex","-1")})),x.isTrapped=o},S=function(e){return{focus:g,toggleExpanded:A,getExpanded:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return E(t)},toggleFocusTrap:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return k(t)}}},C=function(e){var t=p(e),n=t.inlineAttributes,r=t.rules,i=function(t,r){var i=e.getAttribute(t)===String(r),o=!!n.find((function(e){return e.name===t}));if(["class","id","style"].includes(t)||t.startsWith("on"))return c('Cannot assign black-listed attribute: "'.concat(t,'"'));o||i||e.setAttribute(t,r)};Object.keys(r).forEach((function(t){if(e.matches(t)){var n=r[t],o=n.aria,a=n.attr;o&&Object.keys(o).forEach((function(e){return i("aria-".concat(e),o[e])})),a&&Object.keys(a).forEach((function(e){return i(e,a[e])}))}}))},j=function(e){var t=p(e),n=t.rules,r=t.methods;Object.keys(n).forEach((function(t){if(f.removeAll(t),e.matches(t)){var i=n[t],o=i.keyboard,a=i.keyboardEvent;if(o){var u=S(e),s=Object.keys(o),l=a&&["keydown","keypress","keyup"].includes(a),d=l?a:"keydown";a&&!l&&c('"'.concat(a,'" is not a valid keyboard event; using "keydown" instead.')),f.add(t,d,(function(e){s.includes(e.key)&&o[e.key].forEach((function(t){return r[t](u,e)}))}))}}}))},w=function(e){var t=p(e),n=t.rules,r=t.methods;Object.keys(n).forEach((function(t){if(f.removeAll(t),e.matches(t)){var i=n[t].mouse;if(i){var o=S(e),a=i.click,c=i.enter,u=i.leave,s=function(e,n){f.add(t,n,(function(t){e.forEach((function(e){return r[e](o,t)}))}))};a&&s(a,"click"),c&&s(c,"mouseenter"),u&&s(u,"mouseleave")}}}))},O=function(e){var t=p(e),n=t.rules,r=t.screenReaderElement,i=Object.keys(n).reverse().find((function(t){return e.matches(t)&&"string"==typeof n[t].screenReaderText}));if(!i)return r&&r.remove();var o=n[i].screenReaderText;h(e,(function(e){var t;return e.screenReaderElement=e.screenReaderElement||((t=document.createElement("span")).style="position:absolute;z-index:-9999999;opacity:0;",t),e})),t.screenReaderElement.remove(),t.screenReaderElement.textContent=o,e.insertBefore(t.screenReaderElement,e.firstChild)},I=function(e){C(e),j(e),w(e),O(e),f.update()},R={updateAttrsInState:function(e,t){t.forEach((function(t){var n=t?t.target.attributes[t.attributeName]:{};h(e,(function(e){var t=e.inlineAttributes.findIndex((function(e){return e.name===n.name})),r=-1!==t?t:e.inlineAttributes.length;return n?e.inlineAttributes[r]=n:function(e,t){var n=e.length-1,r=e[n],i=e[t];e[n]=i,e[t]=r,e.pop()}(e.inlineAttributes,r),e}))}))},removeNonInlineAttrs:function(e){var t=p(e).inlineAttributes;Array.from(e.attributes).forEach((function(n){var r=n.name;!!t.find((function(e){return e.name===r}))||e.removeAttribute(r)}))},updateChildElAttrs:function(e){var t=this;e.querySelectorAll("*").forEach((function(e){var n=p(e).attributeObserver;n&&n.disconnect(),t.removeNonInlineAttrs(e),I(e),n&&setTimeout((function(){return n.observe(e,{attributes:!0})}),0)}))},setAttrChangeCallback:function(e){var t=this;this.attrChangeCallback=function(n,r){r.disconnect();var i=n.filter((function(e){var t=e.target,n=e.attributeName;return t.attributes[n]}));t.updateAttrsInState(e,i),t.removeNonInlineAttrs(e),I(e),t.updateChildElAttrs(e),setTimeout((function(){r.observe(e,{attributes:!0})}),0)}},attrChangeCallback:null},T={setApplyRulesCallback:function(e){var n=Object.keys(e.rules).sort(y);this.applyRulesCallback=function(o){return n.forEach((function(n){if(o&&!i(o.find((function(e){return e.addedNodes})).addedNodes).some((function(e){return e instanceof HTMLElement&&e.matches(n)})))return;s(n)&&b().querySelectorAll(n).forEach((function(i){var o=e.rules,a=e.methods,c=o&&o[n]||{};h(i,(function(e){return e.rules[n]=c,e.methods=a,e})),I(i),function(e){R.setAttrChangeCallback(e);var n=void 0!==n?n:function(){function e(){t(this,e)}return r(e,[{key:"observe",value:function(){}}]),e}(),i=new n(R.attrChangeCallback);i.observe(e,{attributes:!0}),h(e,(function(e){return e.attributeObserver=i,e}))}(i)}))}))}},applyRulesCallback:null,observer:null},q=function(e){var n=e?e.constructor.name:String(e);e&&e.constructor===Object||u("Expected Object, but got ".concat(n)),d.element=e.root;var i=e.rules||{},o=e.methods||{};i.constructor===Object&&o.constructor===Object||u("The `rules` and `methods` properties must be objects."),T.setApplyRulesCallback(e);var a=void 0!==a?a:function(){function e(){t(this,e)}return r(e,[{key:"observe",value:function(){}}]),e}();T.observer=new a(T.applyRulesCallback),T.observer.observe(b(),{childList:!0,subtree:!0}),T.applyRulesCallback()};e.addAccessibilityRules=q,e.default=q,Object.defineProperty(e,"__esModule",{value:!0})}));